# Blueprint: VS Code Extension with Free/Premium Features using LemonSqueezy

This is a comprehensive blueprint for creating VS Code extensions with a freemium model - offering both free and premium (paid) features. It integrates with LemonSqueezy's License API for payment processing and license management.

## Purpose

This blueprint helps developers:
1. Create VS Code extensions with a freemium business model
2. Integrate LemonSqueezy for payment processing and license management
3. Implement secure offline usage capabilities
4. Handle license activation, validation, and deactivation

## Table of Contents

- [Introduction](#introduction)
- [Getting Started](#getting-started)
  - [Requirements](#requirements)
  - [Base URL](#base-url)
  - [Rate Limits](#rate-limits)
- [Authentication](#authentication)
- [API Endpoints](#api-endpoints)
  - [Activate a License Key](#activate-a-license-key)
  - [Validate a License Key](#validate-a-license-key)
  - [Deactivate a License Key](#deactivate-a-license-key)
- [License Key Status](#license-key-status)
- [Error Handling](#error-handling)
- [Implementation Examples](#implementation-examples)
  - [Node.js](#nodejs)
- [Best Practices](#best-practices)
- [FAQ](#faq)
- [Troubleshooting](#troubleshooting)
- [Contributing](#contributing)
- [License](#license)

## Introduction

The LemonSqueezy License API is designed for managing licenses generated by LemonSqueezy, a platform for selling digital products. This API enables you to activate, validate, or deactivate license keys, which is essential for software and digital content sellers to control access for their customers.

## Getting Started

### Requirements

To use the LemonSqueezy License API, you'll need:

- A LemonSqueezy account with digital products and licenses
- Basic knowledge of API integrations
- Ability to make HTTP requests

### Base URL

All API requests must be made over HTTPS to:

```
https://api.lemonsqueezy.com
```

### Rate Limits

The API enforces a rate limit of **60 requests per minute** per IP address. If you exceed this limit, you'll receive a `429 Too Many Requests` response. Implement appropriate retry logic with exponential backoff to handle rate limiting.

## Authentication

Unlike the main LemonSqueezy API, the License API doesn't appear to require explicit authentication with API keys. Instead, it relies on valid license keys for operation. Note that this is unusual for APIs and may have security implications, so handle license keys with appropriate care.

## API Endpoints

### Activate a License Key

Activates a license key for a specific instance, such as a user's device or installation.

**Endpoint:** `POST /v1/licenses/activate`

**Headers:**
```
Accept: application/json
Content-Type: application/x-www-form-urlencoded
```

**Parameters:**

| Name | Type | Required | Description |
|------|------|----------|-------------|
| `license_key` | string | Yes | The license key to activate |
| `instance_name` | string | Yes | A label for the instance (e.g., "John's MacBook") |

**Example Request:**
```bash
curl -X POST https://api.lemonsqueezy.com/v1/licenses/activate \
-H "Accept: application/json" \
-H "Content-Type: application/x-www-form-urlencoded" \
-d "license_key=38b1460a-5104-4067-a91d-77b872934d51" \
-d "instance_name=Test"
```

**Success Response (200 OK):**
```json
{
  "activated": true,
  "error": null,
  "license_key": {
    "id": 1,
    "status": "active",
    "key": "38b1460a-5104-4067-a91d-77b872934d51",
    "activation_limit": 1,
    "activation_usage": 5,
    "created_at": "2021-01-24T14:15:07.000000Z",
    "expires_at": null
  },
  "instance": {
    "id": "47596ad9-a811-4ebf-ac8a-03fc7b6d2a17",
    "name": "Test",
    "created_at": "2021-04-06T14:15:07.000000Z"
  },
  "meta": {
    "store_id": 1,
    "order_id": 2,
    "order_item_id": 3,
    "product_id": 4,
    "product_name": "Example Product",
    "variant_id": 5,
    "variant_name": "Default",
    "customer_id": 6,
    "customer_name": "John Doe",
    "customer_email": "john@example.com"
  }
}
```

**Important:** Store the returned `instance.id` securely, as you'll need it for future validation and deactivation requests.

### Validate a License Key

Verifies if a license key is valid and returns its current status.

**Endpoint:** `POST /v1/licenses/validate`

**Headers:**
```
Accept: application/json
Content-Type: application/x-www-form-urlencoded
```

**Parameters:**

| Name | Type | Required | Description |
|------|------|----------|-------------|
| `license_key` | string | Yes | The license key to validate |
| `instance_id` | string | No | ID of a specific instance to validate |

**Example Request:**
```bash
curl -X POST https://api.lemonsqueezy.com/v1/licenses/validate \
-H "Accept: application/json" \
-H "Content-Type: application/x-www-form-urlencoded" \
-d "license_key=38b1460a-5104-4067-a91d-77b872934d51" \
-d "instance_id=f90ec370-fd83-46a5-8bbd-44a241e78665"
```

**Success Response (200 OK):**
```json
{
  "valid": true,
  "error": null,
  "license_key": {
    "id": 1,
    "status": "active",
    "key": "38b1460a-5104-4067-a91d-77b872934d51",
    "activation_limit": 1,
    "activation_usage": 5,
    "created_at": "2021-01-24T14:15:07.000000Z",
    "expires_at": "2022-01-24T14:15:07.000000Z"
  },
  "instance": {
    "id": "f90ec370-fd83-46a5-8bbd-44a241e78665",
    "name": "Test",
    "created_at": "2021-02-24T14:15:07.000000Z"
  },
  "meta": {
    "store_id": 1,
    "order_id": 2,
    "order_item_id": 3,
    "product_id": 4,
    "product_name": "Lemonade",
    "variant_id": 5,
    "variant_name": "Citrus Blast",
    "customer_id": 6,
    "customer_name": "John Doe",
    "customer_email": "john@example.com"
  }
}
```

**Note:** If `instance_id` is omitted, the response will include `"instance": null` but will still validate the license key itself.

### Deactivate a License Key

Deactivates a specific instance of a license key, freeing up an activation slot.

**Endpoint:** `POST /v1/licenses/deactivate`

**Headers:**
```
Accept: application/json
Content-Type: application/x-www-form-urlencoded
```

**Parameters:**

| Name | Type | Required | Description |
|------|------|----------|-------------|
| `license_key` | string | Yes | The license key to deactivate |
| `instance_id` | string | Yes | ID of the instance to deactivate |

**Example Request:**
```bash
curl -X POST https://api.lemonsqueezy.com/v1/licenses/deactivate \
-H "Accept: application/json" \
-H "Content-Type: application/x-www-form-urlencoded" \
-d "license_key=38b1460a-5104-4067-a91d-77b872934d51" \
-d "instance_id=f90ec370-fd83-46a5-8bbd-44a241e78665"
```

**Success Response (200 OK):**
```json
{
  "deactivated": true,
  "error": null,
  "license_key": {
    "id": 1,
    "status": "inactive",
    "key": "38b1460a-5104-4067-a91d-77b872934d51",
    "activation_limit": 5,
    "activation_usage": 0,
    "created_at": "2021-01-24T14:15:07.000000Z",
    "expires_at": null
  },
  "meta": {
    "store_id": 1,
    "order_id": 2,
    "order_item_id": 3,
    "product_id": 4,
    "product_name": "Lemonade",
    "variant_id": 5,
    "variant_name": "Citrus Burst",
    "customer_id": 6,
    "customer_name": "John Doe",
    "customer_email": "john@example.com"
  }
}
```

## License Key Status

License keys can have one of the following statuses:

| Status | Description |
|--------|-------------|
| **inactive** | Valid but no active instances |
| **active** | Has one or more active instances |
| **expired** | Expiry date has passed |
| **disabled** | Manually disabled from the LemonSqueezy dashboard |

## Error Handling

The API uses standard HTTP status codes to indicate success or failure of requests:

| Code | Description |
|------|-------------|
| 200 | Success |
| 400 | Bad request - check the `error` field in the response |
| 404 | Not found - the license key or instance doesn't exist |
| 422 | Validation error - missing or invalid parameters |
| 429 | Too many requests - rate limit exceeded |

All error responses include an `error` field with a detailed message:

```json
{
  "activated": false,
  "error": "License key has reached its activation limit",
  "license_key": { ... }
}
```

## Implementation Examples

### Node.js

```javascript
const axios = require('axios');
const qs = require('querystring');

async function activateLicense(licenseKey, instanceName) {
  try {
    const response = await axios.post(
      'https://api.lemonsqueezy.com/v1/licenses/activate',
      qs.stringify({
        license_key: licenseKey,
        instance_name: instanceName
      }),
      {
        headers: {
          'Accept': 'application/json',
          'Content-Type': 'application/x-www-form-urlencoded'
        }
      }
    );
    
    return response.data;
  } catch (error) {
    if (error.response) {
      console.error('Error:', error.response.data);
      return error.response.data;
    }
    throw error;
  }
}

// Example usage
activateLicense('38b1460a-5104-4067-a91d-77b872934d51', 'Production Server')
  .then(data => console.log(data))
  .catch(err => console.error(err));
```


## Best Practices

1. **Secure License Storage**: Store license keys and instance IDs securely to prevent unauthorized access.

2. **Offline Validation**: Implement a fallback mechanism for offline validation to ensure your software works even when the API is unavailable.

3. **Regular Validation**: Periodically validate licenses to check for status changes (e.g., license disabled by admin).

4. **Graceful Degradation**: If a license expires or becomes invalid, provide a clear path for users to renew or purchase a new license.

5. **Informative Error Messages**: Present user-friendly error messages while logging detailed error information for troubleshooting.

6. **Handle Rate Limits**: Implement exponential backoff and retry mechanisms to handle rate limiting gracefully.

## FAQ

**Q: Can I use the same license key on multiple instances?**  
A: Yes, if the license has a sufficient activation limit. Check the `activation_limit` and `activation_usage` in the response to determine available activations.

**Q: What happens when a license expires?**  
A: The status changes to "expired" and validation requests will return `"valid": false`.

**Q: Can I reactivate a deactivated instance?**  
A: Yes, you can reactivate with the same license key and a new instance name, which will generate a new instance ID.

**Q: How do I handle offline activation?**  
A: Store the license validation response locally and implement a grace period for verification when online connectivity is unavailable.

## Troubleshooting

**Issue**: License activation fails with "License key has reached its activation limit"  
**Solution**: Deactivate unused instances or contact the customer to upgrade their license.

**Issue**: Getting 404 errors when validating a license  
**Solution**: Ensure you're using the correct license key format and that it exists in your LemonSqueezy account.

**Issue**: Deactivation doesn't work  
**Solution**: Verify you're using the correct instance ID that was returned during activation.

## Contributing

Contributions to improve this documentation are welcome! Please submit a pull request or open an issue to discuss changes.

## License

This documentation is provided under the MIT License. See [LICENSE](LICENSE) for details.

---

© 2025 Your Company Name | [Company Website](https://example.com)